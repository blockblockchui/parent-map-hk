<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯è¦ªå­åœ°åœ– | Parent Map HK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        #map { height: 400px; width: 100%; }
        .leaflet-popup-content { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <h1 class="text-2xl font-bold text-gray-900">ğŸ—ºï¸ é¦™æ¸¯è¦ªå­åœ°åœ–</h1>
            <p class="text-sm text-gray-600">ç™¼æ˜å…¨æ¸¯æœ€é©åˆè¦ªå­æ´»å‹•çš„å¥½å»è™•</p>
        </div>
    </header>

    <!-- Filters -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex flex-wrap gap-3">
                <!-- åœ°å€ç¯©é¸ï¼ˆé¦™æ¸¯åå…«å€ï¼‰ -->
                <select id="regionFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">æ‰€æœ‰åœ°å€</option>
                    <optgroup label="æ¸¯å³¶">
                        <option value="ä¸­è¥¿å€">ä¸­è¥¿å€</option>
                        <option value="ç£ä»”">ç£ä»”</option>
                        <option value="æ±å€">æ±å€</option>
                        <option value="å—å€">å—å€</option>
                    </optgroup>
                    <optgroup label="ä¹é¾">
                        <option value="æ²¹å°–æ—º">æ²¹å°–æ—º</option>
                        <option value="æ·±æ°´åŸ—">æ·±æ°´åŸ—</option>
                        <option value="ä¹é¾åŸ">ä¹é¾åŸ</option>
                        <option value="é»ƒå¤§ä»™">é»ƒå¤§ä»™</option>
                        <option value="è§€å¡˜">è§€å¡˜</option>
                    </optgroup>
                    <optgroup label="æ–°ç•Œ">
                        <option value="èƒç£">èƒç£</option>
                        <option value="å±¯é–€">å±¯é–€</option>
                        <option value="å…ƒæœ—">å…ƒæœ—</option>
                        <option value="åŒ—å€">åŒ—å€</option>
                        <option value="å¤§åŸ”">å¤§åŸ”</option>
                        <option value="æ²™ç”°">æ²™ç”°</option>
                        <option value="è¥¿è²¢">è¥¿è²¢</option>
                        <option value="é›¢å³¶">é›¢å³¶</option>
                        <option value="è‘µé’">è‘µé’</option>
                    </optgroup>
                </select>

                <!-- é¡åˆ¥ç¯©é¸ -->
                <select id="categoryFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">æ‰€æœ‰é¡å‹</option>
                    <option value="playhouse">ğŸª éŠæ¨‚å ´</option>
                    <option value="park">ğŸŒ³ å…¬åœ’</option>
                    <option value="museum">ğŸ›ï¸ åšç‰©é¤¨/å±•è¦½</option>
                </select>

                <!-- äººå‡æ¶ˆè²» -->
                <select id="priceFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">ä»»ä½•æ¶ˆè²»</option>
                    <option value="0-100">$0-100</option>
                    <option value="100-200">$100-200</option>
                    <option value="200-400">$200-400</option>
                    <option value="400+">$400+</option>
                </select>

                <!-- é©åˆå¹´é½¡ -->
                <select id="ageFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">ä»»ä½•å¹´é½¡</option>
                    <option value="0-1">0-1æ­²</option>
                    <option value="1-2">1-2æ­²</option>
                    <option value="2-3">2-3æ­²</option>
                    <option value="3-6">3-6æ­²</option>
                    <option value="6-12">6-12æ­²</option>
                    <option value="12+">12æ­²+</option>
                </select>

                <!-- å®¤å…§/å®¤å¤– -->
                <select id="indoorFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">å®¤å…§/å®¤å¤–</option>
                    <option value="indoor">ğŸ  å®¤å…§</option>
                    <option value="outdoor">â˜€ï¸ å®¤å¤–</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Map with Locate Button -->
    <div class="relative">
        <div id="map"></div>
        <button id="locateBtn" class="absolute bottom-4 right-4 z-[500] bg-white p-3 rounded-full shadow-lg hover:bg-gray-100 transition-colors" title="å®šä½æˆ‘çš„ä½ç½®">
            ğŸ“ å®šä½æˆ‘
        </button>
    </div>

    <!-- Results -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">ğŸ“ åœ°é»åˆ—è¡¨</h2>
            <span id="resultCount" class="text-sm text-gray-500">è¼‰å…¥ä¸­...</span>
        </div>
        
        <div id="locationList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Locations will be inserted here -->
        </div>
    </div>

    <script>
        // Location data
        const locations = [
  {
    id: "001", name: "æ¨¹å±‹ Baumhaus", district: "ç£ä»”", region: "hk-island",
    lat: 22.2755, lng: 114.1708, category: "playhouse", indoor: true,
    ageRange: [0, 6], priceType: "medium", priceDescription: "$100-200",
    description: "æœ¨è£½éŠæ¨‚ç©ºé–“ï¼Œæä¾›å‰µæ„è—è¡“èª²ç¨‹åŠæ¢ç´¢æ¨¹å±‹",
    website: "https://www.baumhaus.com.hk/", tips: "å»ºè­°é ç´„",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "ç£ä»” Queen's Road East 36-44è™Ÿ"
  },
  {
    id: "002", name: "Ryze Hong Kong", district: "é°‚é­šæ¶Œ", region: "hk-island",
    lat: 22.2876, lng: 114.2120, category: "playhouse", indoor: true,
    ageRange: [2, 12], priceType: "high", priceDescription: "$200-400",
    description: "é«˜èƒ½é‡è¹¦åºŠå…¬åœ’ï¼Œè¨­æœ‰äº’è¯è¹¦åºŠã€éšœç¤™èª²ç¨‹",
    website: "https://www.ryzehongkong.com/", tips: "é©åˆå¥½å‹•å°æœ‹å‹",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "é°‚é­šæ¶Œ Java Road 321è™Ÿ"
  },
  {
    id: "003", name: "Sooper Yoo", district: "å …å°¼åœ°åŸ", region: "hk-island",
    lat: 22.2815, lng: 114.1265, category: "playhouse", indoor: true,
    ageRange: [3, 12], priceType: "medium", priceDescription: "$100-200",
    description: "ç§‘æŠ€èå…¥é‹å‹•å€ï¼Œè¨­æœ‰äº’å‹•éŠæˆ²ã€F1å¼è³½è»Š",
    website: "https://www.sooperyoo.com/", tips: "ç§‘æŠ€æ„Ÿåè¶³",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "å …å°¼åœ°åŸ Belcher's Street 8è™Ÿ"
  },
  {
    id: "004", name: "Kiztopia", district: "å¤šåˆ†åº—", region: "kowloon",
    lat: 22.3025, lng: 114.1785, category: "playhouse", indoor: true,
    ageRange: [1, 12], priceType: "medium", priceDescription: "$100-200",
    description: "æ•™è‚²å¨›æ¨‚éŠæ¨‚å ´ï¼Œè¨­æœ‰ä¸»é¡Œå€ã€æ»‘æ¢¯ã€è¹¦åºŠ",
    website: "https://kiztopia.com.hk/", tips: "å¤šé–“åˆ†åº—",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: true,
    openingHours: "10:00-20:00", address: "ç£ä»”/å°‡è»æ¾³/æ²™ç”°/å¥§æµ·åŸ"
  },
  {
    id: "005", name: "Super Sports Park", district: "å¤§è§’å’€", region: "kowloon",
    lat: 22.3175, lng: 114.1605, category: "playhouse", indoor: true,
    ageRange: [3, 12], priceType: "high", priceDescription: "$200-400",
    description: "å¤§å‹é‹å‹•ä¸»é¡ŒéŠæ¨‚å ´ï¼Œè¨­æœ‰è¹¦åºŠã€æ”€å²©ç‰†",
    website: "https://www.supersportspark.com/", tips: "é‹å‹•é‡å¤§",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "å¤§è§’å’€ Hoi Fai Road 18è™Ÿ"
  },
  {
    id: "006", name: "æ¨‚é«˜æ¢ç´¢ä¸­å¿ƒ", district: "å°–æ²™å’€", region: "kowloon",
    lat: 22.2942, lng: 114.1745, category: "museum", indoor: true,
    ageRange: [2, 12], priceType: "high", priceDescription: "$200-400",
    description: "æ¨‚é«˜ä¸»é¡Œä¸­å¿ƒï¼Œè¨­æœ‰é¦™æ¸¯å¾®å‹è¤‡è£½å“ã€4Dé›»å½±",
    website: "https://www.legolanddiscoverycentre.com/hong-kong/", tips: "æ¨‚é«˜è¿·å¿…å»",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: true,
    openingHours: "10:00-19:00", address: "å°–æ²™å’€ K11 MUSEA B1å±¤"
  },
  {
    id: "007", name: "Playdot", district: "éŠ…é‘¼ç£", region: "hk-island",
    lat: 22.2795, lng: 114.1830, category: "playhouse", indoor: true,
    ageRange: [0, 12], priceType: "medium", priceDescription: "$100-200",
    description: "è‡ªç„¶éˆæ„Ÿç’°ä¿éŠæ¨‚ç©ºé–“ï¼Œè¨­æœ‰æ„Ÿå®˜å€ã€æ”€çˆ¬",
    website: "https://www.leegardens.com.hk/", tips: "ç’°ä¿ä¸»é¡Œ",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "éŠ…é‘¼ç£ Lee Garden Two 18æ¨“"
  },
  {
    id: "008", name: "Wise-Kids", district: "ä¸­ç’°/éŠ…é‘¼ç£", region: "hk-island",
    lat: 22.2830, lng: 114.1550, category: "playhouse", indoor: true,
    ageRange: [0, 6], priceType: "medium", priceDescription: "$100-200",
    description: "æ˜äº®éŠæ¨‚å®¤ï¼Œè¨­æœ‰è¼ªæ›æœ¨è£½ç©å…·ã€å‰µæ„è§’è½",
    website: "https://www.wisekidsplayroom.com/", tips: "æ³¨é‡å‰µæ„ç™¼å±•",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "ä¸­ç’°/éŠ…é‘¼ç£"
  },
  {
    id: "009", name: "EpicLand", district: "å•Ÿå¾·/æ„‰æ™¯ç£", region: "kowloon",
    lat: 22.3305, lng: 114.2030, category: "playhouse", indoor: true,
    ageRange: [2, 12], priceType: "high", priceDescription: "$200-400",
    description: "å†’éšªä¸»é¡Œå…¬åœ’ï¼Œè¨­æœ‰å·¨å‹æ»‘æ¢¯ã€éšœç¤™èª²ç¨‹",
    website: "https://www.epiclandhk.com/", tips: "å ´åœ°å¾ˆå¤§",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "å•Ÿå¾·é«”è‚²åœ’/æ„‰æ™¯ç£"
  },
  {
    id: "010", name: "Momoland", district: "å¤šåˆ†åº—", region: "kowloon",
    lat: 22.3145, lng: 114.1670, category: "playhouse", indoor: true,
    ageRange: [2, 12], priceType: "medium", priceDescription: "$100-200",
    description: "ä¸»é¡ŒéŠæ¨‚å±‹ï¼Œè¨­æœ‰å¿è€…è¿·å®®ã€è§’è‰²æ‰®æ¼”å€",
    website: "https://momoland.com.hk/", tips: "è§’è‰²æ‰®æ¼”ç‚ºä¸»",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "èƒç£/å‘å£/åŒ—è§’/å°‡è»æ¾³"
  },
  // é¦™æ¸¯ç§‘å­¸é¤¨ç³»åˆ—
  {
    id: "011", name: "é¦™æ¸¯ç§‘å­¸é¤¨", district: "å°–æ²™å’€", region: "kowloon",
    lat: 22.3015, lng: 114.1790, category: "museum", indoor: true,
    ageRange: [3, 12], priceType: "free", priceDescription: "å…è²»",
    description: "äº’å‹•å¼ç§‘å­¸å±•è¦½ï¼Œå°æœ‹å‹å¯ä»¥å‹•æ‰‹é«”é©—ç§‘å­¸åŸç†",
    website: "https://hk.science.museum", tips: "å»ºè­°å¹³æ—¥å»ï¼Œå‘¨ä¸‰ä¼‘é¤¨",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "10:00-19:00ï¼ˆå‘¨ä¸‰ä¼‘ï¼‰", address: "å°–æ²™å’€ç§‘å­¸é¤¨é“2è™Ÿ", phone: "2732 3232"
  },
  {
    id: "012", name: "é¦™æ¸¯å¤ªç©ºé¤¨", district: "å°–æ²™å’€", region: "kowloon",
    lat: 22.2956, lng: 114.1723, category: "museum", indoor: true,
    ageRange: [4, 12], priceType: "low", priceDescription: "$10-32",
    description: "è›‹å½¢å»ºç¯‰ï¼Œå¤©è±¡å»³æ’­æ”¾æ˜Ÿç©ºç¯€ç›®ï¼Œå®‡å®™å±•è¦½",
    website: "https://hk.space.museum", tips: "å¤©è±¡å»³è¦é å…ˆè²·ç¥¨",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "13:00-21:00ï¼ˆå‘¨äºŒä¼‘ï¼‰", address: "å°–æ²™å’€æ¢³å£«å·´åˆ©é“10è™Ÿ", phone: "2721 0226"
  },
  {
    id: "013", name: "é¦™æ¸¯å‹•æ¤ç‰©å…¬åœ’", district: "ä¸­ç’°", region: "hk-island",
    lat: 22.2783, lng: 114.1555, category: "park", indoor: false,
    ageRange: [0, 12], priceType: "free", priceDescription: "å…è²»",
    description: "ä¸­ç’°ç¶ æ´²ï¼Œæœ‰ç´…é¸›ã€ç‹çŒ´ï¼Œå¤§è‰åªé©åˆå¥”è·‘",
    website: "https://www.lcsd.gov.hk", tips: "æ¨å¬°å…’è»Šè¦å°å¿ƒæ–œè·¯",
    hasBabyRoom: true, hasStrollerAccess: false, hasRestaurant: true, rainyDaySuitable: false,
    openingHours: "05:00-22:00", address: "ä¸­ç’°é›…è³“åˆ©é“", phone: "2530 0154"
  },
  {
    id: "014", name: "The Big Things", district: "èƒç£", region: "nt",
    lat: 22.3756, lng: 114.1094, category: "playhouse", indoor: true,
    ageRange: [1, 6], priceType: "medium", priceDescription: "$160èµ·",
    description: "è‡ªç„¶ä¸»é¡Œå¢æ—å…¬åœ’ï¼Œæœ¨ç²’æ²™æ± ã€ç¹©ç¶²",
    website: "https://www.thebigthings.com", tips: "è¨˜å¾—å¸¶è¥ª",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: true,
    openingHours: "10:00-18:00", address: "èƒç£å—è±ç´—å» ", phone: "3619 0633"
  },
  {
    id: "015", name: "é¦™æ¸¯æ¿•åœ°å…¬åœ’", district: "å¤©æ°´åœ", region: "nt",
    lat: 22.4667, lng: 114.0083, category: "park", indoor: true,
    ageRange: [3, 12], priceType: "low", priceDescription: "$15-30ï¼ˆå‘¨ä¸‰å…è²»ï¼‰",
    description: "æ¿•åœ°ç”Ÿæ…‹å±•è¦½ï¼Œè§€é³¥å±‹ã€ç´…æ¨¹æ—æ­¥é“",
    website: "https://www.wetlandpark.gov.hk", tips: "å¸¶æœ›é é¡è§€é³¥",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: true,
    openingHours: "10:00-17:00ï¼ˆå‘¨ä¸€ä¼‘ï¼‰", address: "å¤©æ°´åœæ¿•åœ°å…¬åœ’è·¯", phone: "3152 2666"
  },
  {
    id: "016", name: "JOYPOLIS SPORTS", district: "å•Ÿå¾·", region: "kowloon",
    lat: 22.3260, lng: 114.1980, category: "playhouse", indoor: true,
    ageRange: [3, 12], priceType: "high", priceDescription: "$200-400",
    description: "é‹å‹•å¨›æ¨‚ç¶œåˆé«”ï¼Œå¿è€…èª²ç¨‹ã€VRé‹å‹•",
    website: "https://hk-joypolis-sports.com", tips: "å•Ÿå¾·é«”è‚²åœ’æœ€æ–°è¨­æ–½",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "å•Ÿå¾·é«”è‚²åœ’å¥åº·ä¸­å¿ƒ"
  },
  {
    id: "017", name: "KidZania", district: "å¤§å¶¼å±±", region: "nt",
    lat: 22.3160, lng: 113.9360, category: "playhouse", indoor: true,
    ageRange: [3, 12], priceType: "high", priceDescription: "$200-400",
    description: "è¿·ä½ åŸå¸‚ï¼Œè§’è‰²æ‰®æ¼”è·æ¥­é«”é©—",
    website: "https://www.kidzania.com.hk", tips: "11 SKIES å•†å ´å…§",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: true,
    openingHours: "è«‹æŸ¥è©¢å®˜ç¶²", address: "èˆªå¤©åŸæ±è·¯8è™Ÿ 11 SKIES"
  },
  {
    id: "018", name: "Nobi Nobi", district: "å°‡è»æ¾³", region: "nt",
    lat: 22.3070, lng: 114.2600, category: "playhouse", indoor: true,
    ageRange: [0, 12], priceType: "medium", priceDescription: "$100-200",
    description: "å¤§å‹å®¤å…§éŠæ¨‚å ´ï¼Œè¨­æœ‰å¹»ç‡ˆåŸå ¡ã€ç¹©ç¶²",
    website: "https://www.nobinobihk.com", tips: "å°‡è»æ¾³ä¸­å¿ƒå•†å ´",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: false, rainyDaySuitable: true,
    openingHours: "10:00-21:00", address: "å°‡è»æ¾³å”å¾·è¡—9è™Ÿ"
  },
  {
    id: "019", name: "Snoopy World", district: "æ²™ç”°", region: "nt",
    lat: 22.3825, lng: 114.1880, category: "park", indoor: false,
    ageRange: [0, 12], priceType: "free", priceDescription: "å…è²»",
    description: "å²åŠªæ¯”ä¸»é¡Œå…¬åœ’ï¼Œ6å€‹éŠæ¨‚å€",
    website: "https://www.shatin.mk", tips: "æ–°åŸå¸‚å»£å ´3æ¨“å¹³å°",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: false,
    openingHours: "11:00-19:00", address: "æ²™ç”°æ­£è¡—18è™Ÿæ–°åŸå¸‚å»£å ´"
  },
  {
    id: "020", name: "é’è¡£å…¬åœ’", district: "é’è¡£", region: "nt",
    lat: 22.3540, lng: 114.1020, category: "park", indoor: false,
    ageRange: [0, 12], priceType: "free", priceDescription: "å…è²»",
    description: "å¤§å‹å…¬åœ’ï¼Œæœ‰æé¾ä¸»é¡ŒéŠæ¨‚å ´ã€è…³èˆ¹",
    website: "https://www.lcsd.gov.hk", tips: "æé¾è¨­æ–½å¾ˆå¸å¼•",
    hasBabyRoom: true, hasStrollerAccess: true, hasRestaurant: true, rainyDaySuitable: false,
    openingHours: "24å°æ™‚", address: "é’è¡£é’ç¶ è¡—"
  },
  // ç¹¼çºŒæ·»åŠ è‡³50å€‹...
];

        const categoryLabels = {
            museum: 'åšç‰©é¤¨',
            park: 'å…¬åœ’',
            playhouse: 'éŠæ¨‚å ´',
            restaurant: 'é¤å»³',
            library: 'åœ–æ›¸é¤¨'
        };

        const regionLabels = {
            'hk-island': 'æ¸¯å³¶',
            'kowloon': 'ä¹é¾',
            'nt': 'æ–°ç•Œ'
        };

        const priceLabels = {
            free: 'å…è²»',
            low: 'ä½æ¶ˆè²»',
            medium: 'ä¸­æ¶ˆè²»',
            high: 'é«˜æ¶ˆè²»'
        };

        // Initialize Leaflet map
        const map = L.map('map').setView([22.32, 114.17], 11);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Filter state
        let markers = [];

        function renderLocations() {
            const region = document.getElementById('regionFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const age = document.getElementById('ageFilter').value;
            const price = document.getElementById('priceFilter').value;
            const indoor = document.getElementById('indoorFilter').value;

            const filtered = locations.filter(l => {
                // åœ°å€ç¯©é¸ï¼ˆåå…«å€ï¼‰
                if (region !== 'all' && !l.district.includes(region)) return false;
                
                // é¡åˆ¥ç¯©é¸
                if (category !== 'all' && l.category !== category) return false;
                
                // å¹´é½¡ç¯©é¸ï¼ˆ0-1, 1-2, 2-3, 3-6, 6-12, 12+ï¼‰
                if (age !== 'all') {
                    const [minAge, maxAge] = age.split('-').map(a => a === '12+' ? 12 : parseInt(a));
                    if (maxAge) {
                        // ç¯„åœæª¢æŸ¥ï¼ˆä¾‹å¦‚ 3-6ï¼‰
                        if (l.ageRange[1] < minAge || l.ageRange[0] > maxAge) return false;
                    } else {
                        // 12+ æª¢æŸ¥
                        if (l.ageRange[1] < 12) return false;
                    }
                }
                
                // æ¶ˆè²»ç¯©é¸
                if (price !== 'all') {
                    const priceMap = {
                        '0-100': ['free', 'low'],
                        '100-200': ['medium'],
                        '200-400': ['high'],
                        '400+': ['high']
                    };
                    if (!priceMap[price].includes(l.priceType)) return false;
                }
                
                // å®¤å…§/å®¤å¤–ç¯©é¸
                if (indoor === 'indoor' && !l.indoor) return false;
                if (indoor === 'outdoor' && l.indoor) return false;
                
                return true;
            });

            // Update list
            const listEl = document.getElementById('locationList');
            const countEl = document.getElementById('resultCount');
            
            countEl.textContent = `å…± ${filtered.length} å€‹åœ°é»`;
            
            listEl.innerHTML = filtered.map(l => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                    <div class="h-40 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                        <span class="text-white text-4xl">ğŸ¯</span>
                    </div>
                    <div class="p-4">
                        <span class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded">
                            ${categoryLabels[l.category]}
                        </span>
                        <h3 class="text-lg font-bold text-gray-900 mt-1">${l.name}</h3>
                        ${l.nameEn ? `<p class="text-xs text-gray-500">${l.nameEn}</p>` : ''}
                        
                        <div class="flex items-center gap-1 text-sm text-gray-600 my-2">
                            <span>ğŸ“</span>
                            <span>${regionLabels[l.region]} Â· ${l.district}</span>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-3">
                            ${l.indoor ? '<span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded">å®¤å…§</span>' : ''}
                            ${l.rainyDaySuitable ? '<span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">â˜‚ï¸é›¨å¤©é©åˆ</span>' : ''}
                            ${l.hasBabyRoom ? '<span class="text-xs bg-pink-100 text-pink-700 px-2 py-1 rounded">ğŸ‘¶å“ºä¹³å®¤</span>' : ''}
                            ${l.hasRestaurant ? '<span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">ğŸ´æœ‰é¤å»³</span>' : ''}
                        </div>

                        <div class="flex items-center justify-between text-sm mb-3">
                            <span class="text-gray-600">é©åˆï¼š${l.ageRange[0]}-${l.ageRange[1]}æ­²</span>
                            <span class="font-medium ${l.priceType === 'free' ? 'text-green-600' : 'text-gray-700'}">${priceLabels[l.priceType]}</span>
                        </div>

                        <p class="text-sm text-gray-600 line-clamp-2 mb-3">${l.description}</p>

                        <div class="flex items-start gap-2 text-xs text-gray-500 mb-3">
                            <span>ğŸ•</span>
                            <span class="line-clamp-2">${l.openingHours.replace(/\n/g, ' ')}</span>
                        </div>

                        <div class="flex gap-2 pt-3 border-t">
                            ${l.phone ? `<a href="tel:${l.phone}" class="flex-1 py-2 text-sm text-gray-700 bg-gray-100 rounded text-center hover:bg-gray-200 transition-colors">ğŸ“ é›»è©±</a>` : ''}
                            <a href="https://www.google.com/maps/dir/?api=1&destination=${l.lat},${l.lng}" target="_blank" rel="noopener noreferrer" class="flex-1 py-2 text-sm text-green-700 bg-green-50 rounded text-center hover:bg-green-100 transition-colors">ğŸ—ºï¸ è·¯ç·š</a>
                            ${l.website ? `<a href="${l.website}" target="_blank" rel="noopener noreferrer" class="flex-1 py-2 text-sm text-blue-700 bg-blue-50 rounded text-center hover:bg-blue-100 transition-colors">ğŸŒ ç¶²ç«™</a>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');

            // Update map markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            filtered.forEach(l => {
                const marker = L.marker([l.lat, l.lng])
                    .addTo(map)
                    .bindPopup(`
                        <div style="font-family: 'Noto Sans TC', sans-serif;">
                            <b style="font-size: 14px;">${l.name}</b><br>
                            <span style="color: #666; font-size: 12px;">${categoryLabels[l.category]}</span><br>
                            <a href="https://www.google.com/maps/dir/?api=1&destination=${l.lat},${l.lng}" 
                               target="_blank" 
                               style="display: inline-block; margin-top: 8px; padding: 6px 12px; background: #22c55e; color: white; text-decoration: none; border-radius: 4px; font-size: 12px;">
                               ğŸ—ºï¸ å–å¾—è·¯ç·š
                            </a>
                        </div>
                    `);
                markers.push(marker);
            });

            // Fit map to markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Event listeners
        document.getElementById('regionFilter').addEventListener('change', renderLocations);
        document.getElementById('categoryFilter').addEventListener('change', renderLocations);
        document.getElementById('ageFilter').addEventListener('change', renderLocations);
        document.getElementById('priceFilter').addEventListener('change', renderLocations);
        document.getElementById('indoorFilter').addEventListener('change', renderLocations);

        // User location marker
        let userMarker = null;
        let userCircle = null;

        // Geolocation function
        function locateUser() {
            const btn = document.getElementById('locateBtn');
            btn.textContent = 'ğŸ“ å®šä½ä¸­...';
            
            if (!navigator.geolocation) {
                alert('ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½');
                btn.textContent = 'ğŸ“ å®šä½æˆ‘';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    // Remove old marker
                    if (userMarker) {
                        map.removeLayer(userMarker);
                        map.removeLayer(userCircle);
                    }

                    // Add user marker
                    userMarker = L.marker([lat, lng], {
                        icon: L.divIcon({
                            className: 'custom-div-icon',
                            html: "<div style='background-color:#3b82f6;width:20px;height:20px;border-radius:50%;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);'></div>",
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(map).bindPopup('ğŸ“ ä½ çš„ä½ç½®').openPopup();

                    // Add accuracy circle
                    userCircle = L.circle([lat, lng], {
                        radius: accuracy,
                        color: '#3b82f6',
                        fillColor: '#3b82f6',
                        fillOpacity: 0.1
                    }).addTo(map);

                    // Center map on user
                    map.setView([lat, lng], 14);

                    // Sort locations by distance
                    sortByDistance(lat, lng);

                    btn.textContent = 'ğŸ“ å·²å®šä½';
                    setTimeout(() => {
                        btn.textContent = 'ğŸ“ å®šä½æˆ‘';
                    }, 3000);
                },
                (error) => {
                    let message = 'ç„¡æ³•ç²å–ä½ç½®';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message = 'è«‹å…è¨±ä½¿ç”¨å®šä½åŠŸèƒ½';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = 'ä½ç½®è³‡è¨Šä¸å¯ç”¨';
                            break;
                        case error.TIMEOUT:
                            message = 'å®šä½è¶…æ™‚ï¼Œè«‹é‡è©¦';
                            break;
                    }
                    alert(message);
                    btn.textContent = 'ğŸ“ å®šä½æˆ‘';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // Calculate distance between two points (Haversine formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Sort locations by distance from user
        function sortByDistance(userLat, userLng) {
            const sorted = [...locations].sort((a, b) => {
                const distA = calculateDistance(userLat, userLng, a.lat, a.lng);
                const distB = calculateDistance(userLat, userLng, b.lat, b.lng);
                return distA - distB;
            });
            
            // Update list with distance info
            const listEl = document.getElementById('locationList');
            const currentFilter = document.getElementById('regionFilter').value;
            
            // Only show if not filtering by region
            if (currentFilter === 'all') {
                document.getElementById('resultCount').textContent = `å·²æŒ‰è·é›¢æ’åº - å…± ${sorted.length} å€‹åœ°é»`;
            }
        }

        // Event listeners for filters
        document.getElementById('regionFilter').addEventListener('change', renderLocations);
        document.getElementById('categoryFilter').addEventListener('change', renderLocations);
        document.getElementById('ageFilter').addEventListener('change', renderLocations);
        document.getElementById('priceFilter').addEventListener('change', renderLocations);
        document.getElementById('indoorFilter').addEventListener('change', renderLocations);

        // Locate button event
        document.getElementById('locateBtn').addEventListener('click', locateUser);

        // Initial render
        renderLocations();
    </script>
</body>
</html>
