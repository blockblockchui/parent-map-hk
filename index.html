<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯è¦ªå­åœ°åœ– | Parent Map HK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        #map { height: 400px; width: 100%; }
        .leaflet-popup-content { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <h1 class="text-2xl font-bold text-gray-900">ğŸ—ºï¸ é¦™æ¸¯è¦ªå­åœ°åœ–</h1>
            <p class="text-sm text-gray-600">ç™¼æ˜å…¨æ¸¯æœ€é©åˆè¦ªå­æ´»å‹•çš„å¥½å»è™•</p>
        </div>
    </header>

    <!-- Filters -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex flex-wrap gap-3">
                <select id="regionFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">æ‰€æœ‰åœ°å€</option>
                    <option value="hk-island">æ¸¯å³¶</option>
                    <option value="kowloon">ä¹é¾</option>
                    <option value="nt">æ–°ç•Œ</option>
                </select>

                <select id="categoryFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">æ‰€æœ‰é¡å‹</option>
                    <option value="museum">åšç‰©é¤¨</option>
                    <option value="park">å…¬åœ’</option>
                    <option value="playhouse">éŠæ¨‚å ´</option>
                    <option value="restaurant">é¤å»³</option>
                </select>

                <select id="ageFilter" class="px-3 py-2 border rounded-lg text-sm">
                    <option value="all">ä»»ä½•å¹´é½¡</option>
                    <option value="0">0-3æ­²</option>
                    <option value="3">3-6æ­²</option>
                    <option value="6">6-12æ­²</option>
                </select>

                <label class="flex items-center gap-2 px-3 py-2 border rounded-lg cursor-pointer hover:bg-gray-50">
                    <input type="checkbox" id="indoorFilter" class="rounded">
                    <span class="text-sm">å®¤å…§</span>
                </label>

                <label class="flex items-center gap-2 px-3 py-2 border rounded-lg cursor-pointer hover:bg-gray-50">
                    <input type="checkbox" id="freeFilter" class="rounded">
                    <span class="text-sm">å…è²»</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Map with Locate Button -->
    <div class="relative">
        <div id="map"></div>
        <button id="locateBtn" class="absolute bottom-4 right-4 z-[500] bg-white p-3 rounded-full shadow-lg hover:bg-gray-100 transition-colors" title="å®šä½æˆ‘çš„ä½ç½®">
            ğŸ“ å®šä½æˆ‘
        </button>
    </div>

    <!-- Results -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">ğŸ“ åœ°é»åˆ—è¡¨</h2>
            <span id="resultCount" class="text-sm text-gray-500">è¼‰å…¥ä¸­...</span>
        </div>
        
        <div id="locationList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Locations will be inserted here -->
        </div>
    </div>

    <script>
        // Location data
        const locations = [
            {
                id: "001",
                name: "é¦™æ¸¯ç§‘å­¸é¤¨",
                nameEn: "Hong Kong Science Museum",
                category: "museum",
                district: "å°–æ²™å’€",
                region: "kowloon",
                address: "å°–æ²™å’€æ±éƒ¨ç§‘å­¸é¤¨é“2è™Ÿ",
                lat: 22.3015,
                lng: 114.1790,
                ageRange: [3, 12],
                indoor: true,
                priceType: "free",
                hasBabyRoom: true,
                hasStrollerAccess: true,
                hasRestaurant: false,
                rainyDaySuitable: true,
                openingHours: "10:00-19:00ï¼ˆå‘¨ä¸‰ä¼‘é¤¨ï¼‰",
                priceDescription: "å…è²»å…¥å ´ï¼Œéƒ¨åˆ†å±•è¦½æ”¶è²»",
                phone: "2732 3232",
                website: "https://hk.science.museum",
                description: "äº’å‹•å¼ç§‘å­¸å±•è¦½ï¼Œå°æœ‹å‹å¯ä»¥å‹•æ‰‹é«”é©—å„ç¨®ç§‘å­¸åŸç†ã€‚æœ‰èƒ½é‡å‚³éçƒã€é¡å­ä¸–ç•Œç­‰å—æ­¡è¿å±•å€ã€‚",
                tips: "å»ºè­°å¹³æ—¥å»ï¼Œå‘¨æœ«äººè¼ƒå¤š"
            },
            {
                id: "002",
                name: "é¦™æ¸¯å¤ªç©ºé¤¨",
                nameEn: "Hong Kong Space Museum",
                category: "museum",
                district: "å°–æ²™å’€",
                region: "kowloon",
                address: "å°–æ²™å’€æ¢³å£«å·´åˆ©é“10è™Ÿ",
                lat: 22.2956,
                lng: 114.1723,
                ageRange: [4, 12],
                indoor: true,
                priceType: "low",
                hasBabyRoom: true,
                hasStrollerAccess: true,
                hasRestaurant: false,
                rainyDaySuitable: true,
                openingHours: "13:00-21:00ï¼ˆå‘¨ä¸€ã€ä¸‰ã€å››ã€äº”ï¼‰\n10:00-21:00ï¼ˆå‘¨æœ«åŠå‡æœŸï¼‰\nå‘¨äºŒä¼‘é¤¨",
                priceDescription: "å±•è¦½å»³ï¼š$10ï¼Œå¤©è±¡å»³ï¼š$24-$32",
                phone: "2721 0226",
                website: "https://hk.space.museum",
                description: "è›‹å½¢å»ºç¯‰å…§æœ‰å®‡å®™å±•è¦½ã€å¤©è±¡å»³æ’­æ”¾æ˜Ÿç©ºç¯€ç›®ï¼Œé©åˆå°å¤ªç©ºæœ‰èˆˆè¶£çš„å°æœ‹å‹ã€‚",
                tips: "å¤©è±¡å»³ç¯€ç›®è¦é å…ˆè²·ç¥¨"
            },
            {
                id: "003",
                name: "é¦™æ¸¯å‹•æ¤ç‰©å…¬åœ’",
                nameEn: "Hong Kong Zoological and Botanical Gardens",
                category: "park",
                district: "ä¸­ç’°",
                region: "hk-island",
                address: "ä¸­ç’°é›…è³“åˆ©é“",
                lat: 22.2783,
                lng: 114.1555,
                ageRange: [0, 12],
                indoor: false,
                priceType: "free",
                hasBabyRoom: true,
                hasStrollerAccess: true,
                hasRestaurant: true,
                rainyDaySuitable: false,
                openingHours: "05:00-22:00",
                priceDescription: "å…è²»å…¥å ´",
                phone: "2530 0154",
                website: "https://www.lcsd.gov.hk/tc/parks/hkzbg/",
                description: "ä½æ–¼ä¸­ç’°çš„ç¶ æ´²ï¼Œæœ‰ç´…é¸›ã€ç‹çŒ´ç­‰å‹•ç‰©ï¼Œä¹Ÿæœ‰æ¤ç‰©æº«å®¤ã€‚å¤§è‰åªé©åˆå°æœ‹å‹å¥”è·‘ã€‚",
                tips: "æœ‰æ–œè·¯æ¨å¬°å…’è»Šè¦å°å¿ƒ"
            },
            {
                id: "004",
                name: "The Big Things",
                nameEn: "The Big Things Playground",
                category: "playhouse",
                district: "èƒç£",
                region: "nt",
                address: "èƒç£å—è±ç´—å» ",
                lat: 22.3756,
                lng: 114.1094,
                ageRange: [0, 8],
                indoor: true,
                priceType: "medium",
                hasBabyRoom: true,
                hasStrollerAccess: true,
                hasRestaurant: true,
                rainyDaySuitable: true,
                openingHours: "10:00-18:00",
                priceDescription: "$160ï¼ˆ1å¤§1å°ï¼‰",
                phone: "3619 0633",
                website: "https://www.thebigthings.com.hk",
                description: "ä»¥å¤§è‡ªç„¶ç‚ºä¸»é¡Œçš„å®¤å…§éŠæ¨‚å ´ï¼Œæœ‰æœ¨ç²’æ²™æ± ã€ç¹©ç¶²ã€æ»‘æ¢¯ç­‰ã€‚ç’°å¢ƒä¹¾æ·¨ï¼Œè·å“¡å‹å–„ã€‚",
                tips: "è¨˜å¾—å¸¶è¥ªï¼Œå¤§äººç´°è·¯éƒ½è¦"
            },
            {
                id: "005",
                name: "é¦™æ¸¯æ¿•åœ°å…¬åœ’",
                nameEn: "Hong Kong Wetland Park",
                category: "park",
                district: "å¤©æ°´åœ",
                region: "nt",
                address: "å¤©æ°´åœæ¿•åœ°å…¬åœ’è·¯",
                lat: 22.4667,
                lng: 114.0083,
                ageRange: [3, 12],
                indoor: true,
                priceType: "low",
                hasBabyRoom: true,
                hasStrollerAccess: true,
                hasRestaurant: true,
                rainyDaySuitable: true,
                openingHours: "10:00-17:00ï¼ˆå‘¨ä¸€ä¼‘é¤¨ï¼‰",
                priceDescription: "$30ï¼ˆæˆäººï¼‰ï¼Œ$15ï¼ˆå°ç«¥ï¼‰ï¼Œå‘¨ä¸‰å…è²»",
                phone: "3152 2666",
                website: "https://www.wetlandpark.gov.hk",
                description: "å®¤å…§å±•è¦½é¤¨ä»‹ç´¹æ¿•åœ°ç”Ÿæ…‹ï¼Œæˆ¶å¤–æœ‰è§€é³¥å±‹ã€ç´…æ¨¹æ—æ­¥é“ã€‚å¯ä»¥è¿‘è·é›¢è§€å¯Ÿé›€é³¥ã€‚",
                tips: "å¸¶æœ›é é¡è§€é³¥æ›´ä½³"
            }
        ];

        const categoryLabels = {
            museum: 'åšç‰©é¤¨',
            park: 'å…¬åœ’',
            playhouse: 'éŠæ¨‚å ´',
            restaurant: 'é¤å»³',
            library: 'åœ–æ›¸é¤¨'
        };

        const regionLabels = {
            'hk-island': 'æ¸¯å³¶',
            'kowloon': 'ä¹é¾',
            'nt': 'æ–°ç•Œ'
        };

        const priceLabels = {
            free: 'å…è²»',
            low: 'ä½æ¶ˆè²»',
            medium: 'ä¸­æ¶ˆè²»',
            high: 'é«˜æ¶ˆè²»'
        };

        // Initialize Leaflet map
        const map = L.map('map').setView([22.32, 114.17], 11);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Filter state
        let markers = [];

        function renderLocations() {
            const region = document.getElementById('regionFilter').value;
            const category = document.getElementById('categoryFilter').value;
            const age = document.getElementById('ageFilter').value;
            const indoor = document.getElementById('indoorFilter').checked;
            const free = document.getElementById('freeFilter').checked;

            const filtered = locations.filter(l => {
                if (region !== 'all' && l.region !== region) return false;
                if (category !== 'all' && l.category !== category) return false;
                if (age !== 'all') {
                    const ageNum = parseInt(age);
                    if (ageNum < l.ageRange[0] || ageNum > l.ageRange[1]) return false;
                }
                if (indoor && !l.indoor) return false;
                if (free && l.priceType !== 'free') return false;
                return true;
            });

            // Update list
            const listEl = document.getElementById('locationList');
            const countEl = document.getElementById('resultCount');
            
            countEl.textContent = `å…± ${filtered.length} å€‹åœ°é»`;
            
            listEl.innerHTML = filtered.map(l => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                    <div class="h-40 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                        <span class="text-white text-4xl">ğŸ¯</span>
                    </div>
                    <div class="p-4">
                        <span class="text-xs font-medium text-blue-600 bg-blue-50 px-2 py-1 rounded">
                            ${categoryLabels[l.category]}
                        </span>
                        <h3 class="text-lg font-bold text-gray-900 mt-1">${l.name}</h3>
                        <p class="text-xs text-gray-500">${l.nameEn}</p>
                        
                        <div class="flex items-center gap-1 text-sm text-gray-600 my-2">
                            <span>ğŸ“</span>
                            <span>${regionLabels[l.region]} Â· ${l.district}</span>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-3">
                            ${l.indoor ? '<span class="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded">å®¤å…§</span>' : ''}
                            ${l.rainyDaySuitable ? '<span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">â˜‚ï¸é›¨å¤©é©åˆ</span>' : ''}
                            ${l.hasBabyRoom ? '<span class="text-xs bg-pink-100 text-pink-700 px-2 py-1 rounded">ğŸ‘¶å“ºä¹³å®¤</span>' : ''}
                            ${l.hasRestaurant ? '<span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">ğŸ´æœ‰é¤å»³</span>' : ''}
                        </div>

                        <div class="flex items-center justify-between text-sm mb-3">
                            <span class="text-gray-600">é©åˆï¼š${l.ageRange[0]}-${l.ageRange[1]}æ­²</span>
                            <span class="font-medium ${l.priceType === 'free' ? 'text-green-600' : 'text-gray-700'}">${priceLabels[l.priceType]}</span>
                        </div>

                        <p class="text-sm text-gray-600 line-clamp-2 mb-3">${l.description}</p>

                        <div class="flex items-start gap-2 text-xs text-gray-500 mb-3">
                            <span>ğŸ•</span>
                            <span class="line-clamp-2">${l.openingHours.replace(/\n/g, ' ')}</span>
                        </div>

                        <div class="flex gap-2 pt-3 border-t">
                            ${l.phone ? `<a href="tel:${l.phone}" class="flex-1 py-2 text-sm text-gray-700 bg-gray-100 rounded text-center hover:bg-gray-200 transition-colors">ğŸ“ é›»è©±</a>` : ''}
                            ${l.website ? `<a href="${l.website}" target="_blank" rel="noopener noreferrer" class="flex-1 py-2 text-sm text-blue-700 bg-blue-50 rounded text-center hover:bg-blue-100 transition-colors">ğŸŒ ç¶²ç«™</a>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');

            // Update map markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            filtered.forEach(l => {
                const marker = L.marker([l.lat, l.lng])
                    .addTo(map)
                    .bindPopup(`<b>${l.name}</b><br>${categoryLabels[l.category]}`);
                markers.push(marker);
            });

            // Fit map to markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Event listeners
        document.getElementById('regionFilter').addEventListener('change', renderLocations);
        document.getElementById('categoryFilter').addEventListener('change', renderLocations);
        document.getElementById('ageFilter').addEventListener('change', renderLocations);
        document.getElementById('indoorFilter').addEventListener('change', renderLocations);
        document.getElementById('freeFilter').addEventListener('change', renderLocations);

        // User location marker
        let userMarker = null;
        let userCircle = null;

        // Geolocation function
        function locateUser() {
            const btn = document.getElementById('locateBtn');
            btn.textContent = 'ğŸ“ å®šä½ä¸­...';
            
            if (!navigator.geolocation) {
                alert('ä½ çš„ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½');
                btn.textContent = 'ğŸ“ å®šä½æˆ‘';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    // Remove old marker
                    if (userMarker) {
                        map.removeLayer(userMarker);
                        map.removeLayer(userCircle);
                    }

                    // Add user marker
                    userMarker = L.marker([lat, lng], {
                        icon: L.divIcon({
                            className: 'custom-div-icon',
                            html: "<div style='background-color:#3b82f6;width:20px;height:20px;border-radius:50%;border:3px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);'></div>",
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(map).bindPopup('ğŸ“ ä½ çš„ä½ç½®').openPopup();

                    // Add accuracy circle
                    userCircle = L.circle([lat, lng], {
                        radius: accuracy,
                        color: '#3b82f6',
                        fillColor: '#3b82f6',
                        fillOpacity: 0.1
                    }).addTo(map);

                    // Center map on user
                    map.setView([lat, lng], 14);

                    // Sort locations by distance
                    sortByDistance(lat, lng);

                    btn.textContent = 'ğŸ“ å·²å®šä½';
                    setTimeout(() => {
                        btn.textContent = 'ğŸ“ å®šä½æˆ‘';
                    }, 3000);
                },
                (error) => {
                    let message = 'ç„¡æ³•ç²å–ä½ç½®';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message = 'è«‹å…è¨±ä½¿ç”¨å®šä½åŠŸèƒ½';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = 'ä½ç½®è³‡è¨Šä¸å¯ç”¨';
                            break;
                        case error.TIMEOUT:
                            message = 'å®šä½è¶…æ™‚ï¼Œè«‹é‡è©¦';
                            break;
                    }
                    alert(message);
                    btn.textContent = 'ğŸ“ å®šä½æˆ‘';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // Calculate distance between two points (Haversine formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Sort locations by distance from user
        function sortByDistance(userLat, userLng) {
            const sorted = [...locations].sort((a, b) => {
                const distA = calculateDistance(userLat, userLng, a.lat, a.lng);
                const distB = calculateDistance(userLat, userLng, b.lat, b.lng);
                return distA - distB;
            });
            
            // Update list with distance info
            const listEl = document.getElementById('locationList');
            const currentFilter = document.getElementById('regionFilter').value;
            
            // Only show if not filtering by region
            if (currentFilter === 'all') {
                document.getElementById('resultCount').textContent = `å·²æŒ‰è·é›¢æ’åº - å…± ${sorted.length} å€‹åœ°é»`;
            }
        }

        // Locate button event
        document.getElementById('locateBtn').addEventListener('click', locateUser);

        // Initial render
        renderLocations();
    </script>
</body>
</html>
